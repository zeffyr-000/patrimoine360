@if (loading()) {
  <div class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
  </div>
} @else if (recentActions().length > 0) {
  <section class="actions-section">
    <ng-template #actionCard let-action="action">
      <mat-card class="action-card" [class]="'status-' + action.status">
        <div class="status-ribbon" [class]="'status-' + action.status">
          <mat-icon>{{ getActionStatusIcon(action.status) }}</mat-icon>
          <span>{{ 'home.action_status.' + action.status | transloco }}</span>
        </div>
        <div class="card-body">
          <div class="card-header">
            <div class="card-icon" [style.background-color]="getAssetCategory(action.category).color">
              <mat-icon>{{ getActionTypeIcon(action.type) }}</mat-icon>
            </div>
            <div class="card-title-group">
              <h3 class="card-title">{{ action.title }}</h3>
              <div class="card-tags">
                <span class="tag category-tag">
                  <mat-icon [style.color]="getAssetCategory(action.category).color">
                    {{ getAssetCategory(action.category).icon }}
                  </mat-icon>
                  {{ getAssetCategory(action.category).label }}
                </span>
                <span class="tag type-tag">{{ 'home.action_types.' + action.type | transloco }}</span>
              </div>
            </div>
          </div>
          <p class="card-description">{{ action.description }}</p>
          @if (action.impact) {
            <div class="impact-box" [class.has-value]="action.impactValue && action.impactValue > 0">
              <div class="impact-icon">
                <mat-icon>{{ action.impactValue && action.impactValue > 0 ? 'trending_up' : 'insights' }}</mat-icon>
              </div>
              <div class="impact-details">
                <span class="impact-title">{{ 'home.impact_label' | transloco }}</span>
                <p class="impact-description">{{ action.impact }}</p>
                @if (action.impactValue && action.impactValue > 0) {
                  <div class="impact-amount">
                    <mat-icon>add_circle</mat-icon>
                    <strong>{{ formatCurrency(action.impactValue) }}</strong>
                  </div>
                }
              </div>
            </div>
          }
        </div>
      </mat-card>
    </ng-template>

    <div class="timeline-header-compact">
      <div class="header-left">
        <div class="header-badge">
          <mat-icon>workspace_premium</mat-icon>
        </div>
        <div class="header-text">
          <h1>{{ 'actions.year_review_title' | transloco }}</h1>
          <span class="header-meta">{{ completedCount() }} {{ 'home.actions_completed' | transloco }}</span>
        </div>
      </div>

      <div class="header-stats-compact">
        <div class="stat-main">
          <span class="stat-value">{{ formatCurrency(totalImpact()) }}</span>
          <span class="stat-label">{{ 'actions.total_value_created' | transloco }}</span>
        </div>
        <div class="stat-divider"></div>
        <div class="stat-breakdown">
          <div
            class="mini-stat"
            [matTooltip]="'actions.tooltip_tax_savings' | transloco"
            matTooltipClass="premium-tooltip"
            matTooltipPosition="below"
          >
            <mat-icon>savings</mat-icon>
            <span>{{ formatCurrency(taxSavings()) }}</span>
          </div>
          <div
            class="mini-stat"
            [matTooltip]="'actions.tooltip_realized_gains' | transloco"
            matTooltipClass="premium-tooltip"
            matTooltipPosition="below"
          >
            <mat-icon>trending_up</mat-icon>
            <span>{{ formatCurrency(realizedGains()) }}</span>
          </div>
          <div
            class="mini-stat"
            [matTooltip]="'actions.tooltip_transmission' | transloco"
            matTooltipClass="premium-tooltip"
            matTooltipPosition="below"
          >
            <mat-icon>family_restroom</mat-icon>
            <span>{{ formatCurrency(transmissionSavings()) }}</span>
          </div>
        </div>
      </div>

      <div class="header-legend">
        <div class="legend-item">
          <span class="dot completed"></span>{{ 'home.action_status.completed' | transloco }}
        </div>
        <div class="legend-item">
          <span class="dot in_progress"></span>{{ 'home.action_status.in_progress' | transloco }}
        </div>
        <div class="legend-item"><span class="dot planned"></span>{{ 'home.action_status.planned' | transloco }}</div>
      </div>
    </div>

    <div class="journey-timeline">
      <div class="timeline-spine"></div>

      @for (action of recentActions(); track action.id; let i = $index; let isEven = $even) {
        <div class="timeline-entry" [class.left]="isEven" [class.right]="!isEven">
          <div class="entry-col entry-col-left">
            @if (isEven) {
              <div class="card-wrapper">
                <ng-container *ngTemplateOutlet="actionCard; context: { action: action }"></ng-container>
                <div class="card-connector" [class]="'status-' + action.status"></div>
              </div>
            }
          </div>

          <div class="entry-col entry-col-center">
            <div class="timeline-marker" [class]="'status-' + action.status">
              <div class="marker-icon-ring">
                <mat-icon>{{ getActionTypeIcon(action.type) }}</mat-icon>
              </div>
              <div class="marker-date">
                <span class="date-day">{{ action.date | date: 'd' }}</span>
                <span class="date-month">{{ action.date | date: 'MMM' }}</span>
                <span class="date-year">{{ action.date | date: 'yyyy' }}</span>
              </div>
            </div>
          </div>

          <div class="entry-col entry-col-right">
            @if (!isEven) {
              <div class="card-wrapper">
                <div class="card-connector" [class]="'status-' + action.status"></div>
                <ng-container *ngTemplateOutlet="actionCard; context: { action: action }"></ng-container>
              </div>
            }
          </div>
        </div>
      }

      <div class="timeline-entry timeline-footer-entry">
        <div class="entry-col entry-col-left"></div>
        <div class="entry-col entry-col-center">
          <div class="footer-icon">
            <mat-icon>flag</mat-icon>
          </div>
        </div>
        <div class="entry-col entry-col-right"></div>
      </div>
    </div>

    <div class="timeline-footer-message">
      <p>{{ 'home.journey_continues' | transloco }}</p>
    </div>
  </section>
} @else {
  <div class="empty-state">
    <div class="empty-state-icon">
      <mat-icon>event_note</mat-icon>
    </div>
    <h2>{{ 'actions.empty_state_title' | transloco }}</h2>
    <p>{{ 'actions.empty_state_description' | transloco }}</p>
  </div>
}
