@if (loading()) {
  <div class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
  </div>
} @else {
  <div class="assets-page">
    <header class="assets-header">
      <div class="header-content">
        <div class="header-icon">
          <mat-icon>account_balance_wallet</mat-icon>
        </div>
        <div class="header-text">
          <h1>{{ 'assets.title' | transloco }}</h1>
          <p class="header-subtitle">{{ 'assets.subtitle' | transloco }}</p>
        </div>
      </div>
      <div class="header-summary">
        <div class="summary-stat">
          <span class="summary-value">{{ assets().length }}</span>
          <span class="summary-label">{{ 'assets.total_assets' | transloco }}</span>
        </div>
        <div class="summary-divider"></div>
        <div class="summary-stat highlight">
          <span class="summary-value">{{ formatCurrency(totalValue()) }}</span>
          <span class="summary-label">{{ 'assets.total_value' | transloco }}</span>
        </div>
        <div class="summary-divider"></div>
        <div class="summary-stat" [class.positive]="totalGain() >= 0" [class.negative]="totalGain() < 0">
          <span class="summary-value">{{ totalGain() >= 0 ? '+' : '' }}{{ formatCurrency(totalGain()) }}</span>
          <span class="summary-label">{{ 'assets.latent_gains' | transloco }}</span>
        </div>
      </div>
    </header>

    <section class="assets-table-section">
      <table class="assets-table">
        <thead>
          <tr>
            <th class="col-asset">{{ 'assets.col_asset' | transloco }}</th>
            <th class="col-category">{{ 'assets.col_category' | transloco }}</th>
            <th class="col-acquisition">
              {{ 'assets.col_acquisition' | transloco }}
              <mat-icon
                class="hint-icon"
                [matTooltip]="'hints.acquisition_cost' | transloco"
                matTooltipClass="premium-tooltip"
                >help_outline</mat-icon
              >
            </th>
            <th class="col-value">{{ 'assets.col_current_value' | transloco }}</th>
            <th class="col-gain">
              {{ 'assets.col_performance' | transloco }}
              <mat-icon
                class="hint-icon"
                [matTooltip]="'hints.latent_gain' | transloco"
                matTooltipClass="premium-tooltip"
                >help_outline</mat-icon
              >
            </th>
            <th class="col-weight">
              {{ 'assets.col_weight' | transloco }}
              <mat-icon class="hint-icon" [matTooltip]="'hints.weight' | transloco" matTooltipClass="premium-tooltip"
                >help_outline</mat-icon
              >
            </th>
          </tr>
        </thead>
        <tbody>
          @for (asset of assets(); track asset.id) {
            <tr class="asset-row">
              <td class="col-asset">
                <div class="asset-info">
                  <div class="asset-icon" [style.background-color]="getAssetCategory(asset.type).color">
                    <mat-icon>{{ getAssetCategory(asset.type).icon }}</mat-icon>
                  </div>
                  <div class="asset-details">
                    <span class="asset-name">{{ asset.name }}</span>
                    <span class="asset-description">{{ asset.description }}</span>
                    @if (asset.location) {
                      <span class="asset-location">
                        <mat-icon>location_on</mat-icon>
                        {{ asset.location }}
                      </span>
                    }
                  </div>
                </div>
              </td>

              <td class="col-category">
                <span class="category-badge" [style.border-color]="getAssetCategory(asset.type).color">
                  {{ getAssetCategory(asset.type).label }}
                </span>
              </td>

              <!-- Acquisition -->
              <td class="col-acquisition">
                <div class="acquisition-info">
                  <span class="acquisition-cost">{{ formatCurrency(asset.acquisitionCost || asset.value) }}</span>
                  <span class="acquisition-date">{{ formatAcquisitionDate(asset.acquisitionDate) }}</span>
                </div>
              </td>

              <td class="col-value">
                <span class="current-value">{{ formatCurrency(asset.value) }}</span>
              </td>

              <td class="col-gain">
                @if (asset.acquisitionCost && asset.acquisitionCost !== asset.value) {
                  <div
                    class="gain-info"
                    [class.positive]="asset.value >= asset.acquisitionCost"
                    [class.negative]="asset.value < asset.acquisitionCost"
                  >
                    <span class="gain-amount">
                      {{ asset.value >= asset.acquisitionCost ? '+' : ''
                      }}{{ formatCurrency(asset.value - asset.acquisitionCost) }}
                    </span>
                    <span class="gain-percent">
                      {{ asset.value >= asset.acquisitionCost ? '+' : ''
                      }}{{ ((asset.value - asset.acquisitionCost) / asset.acquisitionCost) * 100 | number: '1.1-1' }}%
                    </span>
                  </div>
                } @else {
                  <span class="no-change">â€”</span>
                }
              </td>

              <td class="col-weight">
                <div class="weight-info">
                  <span class="weight-percent">{{ (asset.value / totalValue()) * 100 | number: '1.1-1' }}%</span>
                  <div class="weight-bar">
                    <div
                      class="weight-fill"
                      [style.width.%]="(asset.value / totalValue()) * 100"
                      [style.background-color]="getAssetCategory(asset.type).color"
                    ></div>
                  </div>
                </div>
              </td>
            </tr>
          }
        </tbody>
        <tfoot>
          <tr class="totals-row">
            <td class="col-asset">
              <strong>{{ 'assets.total' | transloco }}</strong>
            </td>
            <td class="col-category"></td>
            <td class="col-acquisition">
              <span class="total-value">{{ formatCurrency(totalAcquisition()) }}</span>
            </td>
            <td class="col-value">
              <span class="total-value highlight">{{ formatCurrency(totalValue()) }}</span>
            </td>
            <td class="col-gain">
              <div class="gain-info total" [class.positive]="totalGain() >= 0" [class.negative]="totalGain() < 0">
                <span class="gain-amount">{{ totalGain() >= 0 ? '+' : '' }}{{ formatCurrency(totalGain()) }}</span>
                <span class="gain-percent">
                  {{ totalGain() >= 0 ? '+' : '' }}{{ (totalGain() / totalAcquisition()) * 100 | number: '1.1-1' }}%
                </span>
              </div>
            </td>
            <td class="col-weight">
              <span class="weight-percent">100%</span>
            </td>
          </tr>
        </tfoot>
      </table>
    </section>

    <footer class="assets-footer">
      <p>
        <mat-icon>info</mat-icon>
        {{ 'assets.footer_note' | transloco: { date: formattedValuationDate() } }}
      </p>
    </footer>
  </div>
}
